<div class="nav"><p><a href="/tidy_css#intro">Intro</a>
<a href="/tidy_css#isolation">CSS Isolation</a>
<a href="/tidy_css#apply">@apply</a>
<a href="/tidy_css#nesting">Nesting</a></p>
</div>
<div class="content"><h1 id="intro">Options for tidy CSS files</h1>
<h2>Scoped CSS, <code>@apply</code>, and nesting</h2>
<p>Idiomatic usage of Tailwind puts the bulk of CSS styling directly in your component's HTML, but you'll probably end up having some CSS files around.  Let's look at some Blazor and Tailwind CSS features that can help us out, and how to set things up so they can work together.</p>
<h2 id="isolation">Blazor's CSS Isolation</h2>
<p>Using .NET's <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components/css-isolation?view=aspnetcore-6.0" target="_blank">CSS Isolation</a> does a couple things for us.  First, it is a bit like a C# <code>namespace</code> for our Components' CSS.  For a component <code>Foo.razor</code>, any CSS file named  using the convention <code>Foo.razor.css</code> will be a &quot;Scoped CSS&quot; file.  CSS in this file will be preprocessed so as to only apply to <code>Foo.razor</code>.  From the docs:</p>
<blockquote>
<p STRING="">For each styled component, an HTML attribute is appended with the format b-, where the  placeholder is a ten-character string generated by the framework. The identifier is unique for each app. In the rendered Counter component, Blazor appends a scope identifier to the h1 element: <code>&lt;h1 b-3xxtam6d07&gt;</code></p>
</blockquote>
<p>Second, it bundles the preprocessed Scoped CSS files into a bundle, <code>Site.styles.css</code> for a project <code>Site.csproj</code>.  If you're OK with limiting all of your scoped CSS files to vanilla CSS, toss in <code>&lt;link href=&quot;Site.styles.css&quot; rel=&quot;stylesheet&quot;&gt;</code> as described <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components/css-isolation?view=aspnetcore-6.0#css-isolation-bundling" target="_blank">here</a> and you're done.  If you want to use Tailwind <code>@apply</code> or nesting as described here, ignore the above docs - the <code>Site.styles.css</code> bundle will be fed to  <code>tailwindcss</code>.</p>
<p>The bundling is handy even if the Scoping/Isolation doesn't add much value for a particular project.</p>
<hr />
<h2 id="apply">Tailwind's <code>@apply</code> directive</h2>
<p>A tiny rant about tidy HTML then i'll get back to the tidy CSS bits.  A relevant snippet from <a href="https://tailwindcss.com/docs/reusing-styles#extracting-classes-with-apply" target="_blank">the docs</a>:</p>
<blockquote>
<p>Whatever you do, don’t use @apply just to make things look “cleaner”. Yes, HTML templates littered with Tailwind classes are kind of ugly. Making changes in a project that has tons of custom CSS is worse.</p>
</blockquote>
<p>A common criticism of the utility-class approach is that long strings of class names gets hard to read, requiring &quot;horizontal panning&quot; of the eyes.  What i don't understand is - why in all of the Tailwind CSS samples i see are all of the class strings on one line ?  In C# (and other languages of course), if a method has more than a few parameters, we format &amp; indent them to look pretty (and fix that 'horizontal panning' thing).  This is an option in HTML class strings as well.  If my HTML is getting messy, i group my classes over multiple lines semantically.  Maybe i put font size/color classes on one line, padding/margins on the next, dark mode on another, give each responsive breakpoint a line of their own, and so on.  A line becomes a rectangle.</p>
<p>OK with that out of my system, on to <code>@apply</code>, which lets us cut long class strings out of our HTML and paste them into a <code>css</code> file and go on our way.  Let's look at this site's <a href="https://github.com/McNerdius/TailBlazor/tree/main/Source/Components/IconLink" target="_blank">IconLink</a> Component as an example.  Without using <code>@apply</code> you'd see something like this:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">IconLink.razor</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font-semibold text-base </pre>
<div class="mc-diff"></div> <pre class="mc-code">            leading-none </pre>
<div class="mc-diff"></div> <pre class="mc-code">            rounded-[4px]</pre>
<div class="mc-diff"></div> <pre class="mc-code">            stroke-black dark:stroke-white </pre>
<div class="mc-diff"></div> <pre class="mc-code">            hover:no-underline </pre>
<div class="mc-diff"></div> <pre class="mc-code">            hover:bg-neutral-200/80</pre>
<div class="mc-diff"></div> <pre class="mc-code">            hover:dark:bg-neutral-700/70<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    ...</pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre>
</div></div>
<p>I had to create a <code>.css</code> file for this component to style Blazor's <code>NavLink</code>, so i figured i'd pull this out while i was at it:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">IconLink.razor</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>link-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    ...</pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre>
</div></div>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">IconLink.razor.css</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token selector">.link-container</span> <span class="token punctuation">{</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">  <span class="token atrule"><span class="token rule">@apply</span> font-semibold text-base </pre>
<div class="mc-diff"></div> <pre class="mc-code">         leading-none </pre>
<div class="mc-diff"></div> <pre class="mc-code">         rounded-[4px] </pre>
<div class="mc-diff"></div> <pre class="mc-code">         stroke-black <span class="token property">dark</span><span class="token punctuation">:</span>stroke-white</pre>
<div class="mc-diff"></div> <pre class="mc-code">         <span class="token property">hover</span><span class="token punctuation">:</span>no-underline </pre>
<div class="mc-diff"></div> <pre class="mc-code">         <span class="token property">hover</span><span class="token punctuation">:</span>bg-neutral-200/80</pre>
<div class="mc-diff"></div> <pre class="mc-code">         <span class="token property">hover</span><span class="token punctuation">:</span><span class="token property">dark</span><span class="token punctuation">:</span>bg-neutral-700/70<span class="token punctuation">;</span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token punctuation">}</span></pre>
</div></div>
<p>A simple cut-paste is all it takes.</p>
<p>Note i've put this in <code>IconLink.razor.css</code> - a Scoped CSS file.  <strong>You could also just name it <code>IconLink.css</code>, <code>@import</code> the file directly in <code>site.css</code> and skip the Blazor integration steps that follow.</strong>  But it only takes a couple edits to take advantage of CSS Isolation and only have to <code>@import</code> the Blazor-generated <code>Site.styles.css</code> bundle.</p>
<div class="info"><p>Here comes the necessary tweaks:  When we use <code>@apply</code> in a Scoped CSS file, the Blazor-generated <code>Site.styles.css</code> is no longer Vanilla CSS, and can't be linked directly in your HTML as shown <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components/css-isolation?view=aspnetcore-6.0#css-isolation-bundling" target="_blank">in the docs</a>.</p>
</div>
<p>By default, for a project <code>Site.csproj</code>, the CSS Isolation will be output to <code>obj/{CONFIGURATION}/{TARGET FRAMEWORK}/scopedcss/bundle/Site.styles.css</code> and copied to <code>wwwroot</code> when the project is published - <code>{Configuration}</code> typically being <code>Debug</code> or <code>Release</code>.  Let's tweak <code>Site.csproj</code> so the filename is constant:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">Site.csproj</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetFramework</span><span class="token punctuation">></span></span>net6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetFramework</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    ...</pre>
<div class="mc-diff mc-ins"></div> <pre class="mc-code mc-ins">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IntermediateOutputPath</span><span class="token punctuation">></span></span>obj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>IntermediateOutputPath</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    ...</pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">></span></span></pre>
</div></div>
<p>The bundle will now be output to <code>/obj/net6.0/scopedcss/bundle</code> for both <code>build</code> and <code>publish</code>.  Add this file to the root CSS created earler, <code>site.css</code>:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">site.css</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">"tailwindcss/base"</span><span class="token punctuation">;</span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">"tailwindcss/components"</span><span class="token punctuation">;</span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">"tailwindcss/utilities"</span><span class="token punctuation">;</span></span></pre>
<div class="mc-diff mc-ins"></div> <pre class="mc-code mc-ins"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">"./obj/net6.0/scopedcss/bundle/site.styles.css"</span><span class="token punctuation">;</span></span></pre>
</div></div>
<div class="info"><p>Make sure to build the Blazor project before attempting an <code>npm run build/watch/publish</code>, or the <code>*.styles.css</code> bundle may be out of date or absent.  Similarly, if you don't actually use Scoped CSS (<code>*.razor.css</code>), a <code>*.styles.css</code> bundle will not be created on disk and <code>npm run build/watch/publish</code> will fail !</p>
</div>
<p>If you're using a <code>watch</code> script, it's a good idea to wait on <code>site.styles.css</code> to be created:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">watch.ps1</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code">dotnet build <span class="token operator">-</span>p:TailwindBuild=false</pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token function">start</span> <span class="token string">"dotnet"</span> <span class="token operator">-</span>ArgumentList <span class="token string">"watch"</span> </pre>
<div class="mc-diff mc-ins"></div> <pre class="mc-code mc-ins"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token string">"./obj/net6.0/scopedcss/bundle/site.styles.css"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">sleep</span> <span class="token operator">-</span>ms 100 <span class="token punctuation">}</span> </pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token string">"./node_modules/.package-lock.json"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">sleep</span> <span class="token operator">-</span>ms 100 <span class="token punctuation">}</span> </pre>
<div class="mc-diff"></div> <pre class="mc-code">npm run watch</pre>
</div></div>
<hr />
<h2 id="nesting">Nesting - there if you want it</h2>
<p>Sass-like <a href="https://tailwindcss.com/docs/using-with-preprocessors#nesting" target="_blank">nesting is included</a> with <code>tailwindcss</code> and enabled by adding a line to your <code>postcss.config.js</code>, no extra dependencies, installs, build steps or boilerplate needed:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">postcss.config.js</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">{</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token string-property property">'postcss-import'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></pre>
<div class="mc-diff mc-ins"></div> <pre class="mc-code mc-ins">        <span class="token string-property property">'tailwindcss/nesting'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token literal-property property">tailwindcss</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token punctuation">}</span></pre>
</div></div>
<p>A couple scenarios where i use nesting:</p>
<ul>
<li><p>Where i can't use CSS Isolation.  This site's content is embedded and rendered using <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.components.markupstring?view=aspnetcore-6.0" target="_blank">MarkupString</a>.  Because the embedded HTML is not part of the component being used to render it, the necessary <code>b-string</code>s are absent, and styles would not be applied.  Instead i wrap the <code>MarkupString</code> in a <code>&lt;div class=&quot;markdown&quot;&gt;</code> and <a href="https://github.com/McNerdius/TailBlazor/blob/main/Source/Pages/Markdown.nested.css" target="_blank">nest away</a>.</p>
</li>
<li><p>To un-stack <a href="https://tailwindcss.com/docs/hover-focus-and-other-states" target="_blank">some stackables</a>.  Being able to &quot;stack&quot; variants is handy: <code>class=&quot;dark:hover:bg-foo&quot;</code> but can get repetetive.  If i've already moved the classes out of my HTML into a CSS file, i may end up un-stacking some things.  Revisiting the <code>IconLink</code> CSS above:</p>
</li>
</ul>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">IconLink.razor.css</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token selector">.link-container</span> <span class="token punctuation">{</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">  <span class="token atrule"><span class="token rule">@apply</span> font-semibold text-base </pre>
<div class="mc-diff"></div> <pre class="mc-code">         leading-none </pre>
<div class="mc-diff"></div> <pre class="mc-code">         rounded-[4px] </pre>
<div class="mc-diff"></div> <pre class="mc-code">         stroke-black <span class="token property">dark</span><span class="token punctuation">:</span>stroke-white</pre>
<div class="mc-diff"></div> <pre class="mc-code">         <span class="token property">hover</span><span class="token punctuation">:</span>no-underline </pre>
<div class="mc-diff"></div> <pre class="mc-code">         <span class="token property">hover</span><span class="token punctuation">:</span>bg-neutral-200/80</pre>
<div class="mc-diff"></div> <pre class="mc-code">         <span class="token property">hover</span><span class="token punctuation">:</span><span class="token property">dark</span><span class="token punctuation">:</span>bg-neutral-700/70<span class="token punctuation">;</span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token punctuation">}</span></pre>
</div></div>
<p>What you'll find i'm actually using is:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">IconLink.razor.css</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token selector">.link-container</span> <span class="token punctuation">{</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">  <span class="token atrule"><span class="token rule">@apply</span> font-semibold text-base </pre>
<div class="mc-diff"></div> <pre class="mc-code">         leading-none </pre>
<div class="mc-diff"></div> <pre class="mc-code">         rounded-[4px] </pre>
<div class="mc-diff"></div> <pre class="mc-code">         stroke-black <span class="token property">dark</span><span class="token punctuation">:</span>stroke-white<span class="token punctuation">;</span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">  <span class="token selector">&amp;:hover</span> <span class="token punctuation">{</span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token atrule"><span class="token rule">@apply</span> no-underline bg-neutral-200/80 </pre>
<div class="mc-diff"></div> <pre class="mc-code">                   <span class="token property">dark</span><span class="token punctuation">:</span>bg-neutral-700/70<span class="token punctuation">;</span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">  <span class="token punctuation">}</span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token punctuation">}</span></pre>
</div></div>
<p>Because why not ?</p>
<hr />
<div class="text-xl italic light text-right pr-6"><p><a href="/next">next: more fun</a></p>
</div>
</div>
