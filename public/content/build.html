<div class="nav"><p><a href="build">Intro</a>
<a href="build#helpers">NPM helper scripts</a>
<a href="build#targets">MSBuild targets</a></p>
<div>
<ul>
<li><a href="build#build">Build or Publish</a></li>
<li><a href="build#install">Install check</a></li>
<li><a href="build#optout">Opting Out</a></li>
</ul>
</div>
<p><a href="build#cli">CLI</a>
<a href="build#vsc">VS Code</a>
<a href="build#vs">Visual Studio</a></p>
</div>
<div class="content"><h1 id="intro">Tailwind Incremental Builds, and maybe Hot Reload</h1>
<p>So far we've put four more-or-less boilerplate files on disk and installed a single package from <code>npm</code> to add Tailwind CSS to the <code>blazorwasm</code> template.  Not too shabby.  Getting build &amp; watch set up is pretty easy too, but unfortunately Hot Reload support is inconsistent between .NET project types.</p>
<p>On the Tailwind side of things, nothing fancy is happening - just a fresh CSS file being output to <code>wwwroot</code> as needed.  For some project types, Hot Reload doesn't refresh the browser when it sees these changes (yet) - hopefully a fix for this seemingly-trivial issue will come soon.  This <a href="https://github.com/dotnet/aspnetcore/issues/37496" target="_blank">GitHub Issue</a> shows a script that reloads the CSS file on a timer.  I think it'd be interesting to make that into a Component - definitely on the todo list.</p>
<p>Ideally Hot Reload would ensure you're seeing latest version of both your Components and CSS.  For some project types this is the case, but some are... less Hot Reloady than others.  Having to do a full rebuild or browser refresh to see updates for some project types is unfortunate, but also outside the scope of integrating Tailwind CSS into those projects.  Hopefully Hot Reload improves in that regard.</p>
<h2 id="helpers">Define <code>npm</code> helper scripts</h2>
<p>In the default <code>package.json</code> you'll see the following:</p>
<p><em>(Yes, that is <code>npx</code> not <code>npm</code>)</em></p>
<p>Connecting the dots here: point the <code>tailwindcss</code> CLI at the relevant config, input, and output files.  <code>npm run build</code> will do a one-off build, <code>npm run watch</code> is what gives us the quick incremental builds akin to Hot Reload, and <code>npm run publish</code> will do a one-off build, plus <code>cssnano</code> minification.</p>
<div class="info"><p>Finally !  Having created <code>site.css</code> and done the initial configuration, running <code>npm run build</code> will run <code>tailwindcss</code>, using <code>site.css</code> and markup specified in <code>tailwind.config.js</code>'s <code>content</code> section to generate a vanilla <code>site.min.css</code>.</p>
</div>
<hr />
<h2 id="targets">Automate <code>npm</code> with MSBuild Targets</h2>
<p>Next, let's set it up so that <code>dotnet</code> CLI or your IDE can care of some of the <code>npm</code> stuff for us.</p>
<p>To keep the <code>*.csproj</code> clean, i use a special MSBuild &quot;Targets&quot; file, cleverly named <code>tailwindcss.targets</code>.  Here's an example file:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">tailwindcss.targets</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Project</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TailwindBuild</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TailwindBuild</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Target</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NpmInstallCheck<span class="token punctuation">"</span></span> <span class="token attr-name">BeforeTargets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS<span class="token punctuation">"</span></span> <span class="token attr-name">Inputs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./package.json<span class="token punctuation">"</span></span> <span class="token attr-name">Outputs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./node_modules/.package-lock.json<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NpmInstallCheck Starting...<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm -v<span class="token punctuation">"</span></span> <span class="token attr-name">ContinueOnError</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">StandardOutputImportance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>low<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Output</span> <span class="token attr-name">TaskParameter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ExitCode<span class="token punctuation">"</span></span> <span class="token attr-name">PropertyName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Exec</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(error)' != '0'<span class="token punctuation">"</span></span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>install node.js please !<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm install<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NpmInstallCheck Finished !<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Target</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Target</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS<span class="token punctuation">"</span></span> <span class="token attr-name">AfterTargets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AfterBuild<span class="token punctuation">"</span></span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(TailwindBuild)' == 'true'<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS Starting...<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm run build<span class="token punctuation">"</span></span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(Configuration)' == 'Debug'<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm run publish<span class="token punctuation">"</span></span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(Configuration)' == 'Release'<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS Finished !<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Target</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Project</span><span class="token punctuation">></span></span></pre>
</div></div>
<p>To actually make use of this in your Blazor project, add it to your <code>*.csproj</code>, top-level:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">site.csproj</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Project</span> <span class="token attr-name">Sdk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Microsoft.NET.Sdk.BlazorWebAssembly<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff mc-ins"></div> <pre class="mc-code mc-ins">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Import</span> <span class="token attr-name">Project</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tailwindcss.targets<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Project</span><span class="token punctuation">></span></span></pre>
</div></div>
<hr />
<h3 id="build">The TailwindCSS Target</h3>
<p>This is the essential section:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">tailwindcss.targets-p2</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Target</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS<span class="token punctuation">"</span></span> <span class="token attr-name">AfterTargets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AfterBuild<span class="token punctuation">"</span></span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(TailwindBuild)' == 'true'<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS Starting...<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm run build<span class="token punctuation">"</span></span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(Configuration)' == 'Debug'<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm run publish<span class="token punctuation">"</span></span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(Configuration)' == 'Release'<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS Finished !<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Target</span><span class="token punctuation">></span></span></pre>
</div></div>
<p><code>AfterBuild</code> is a standard <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/target-element-msbuild" target="_blank">MSBuild Target</a>.  This section defines our own <code>TailwindCSS</code> Target which runs after <code>AfterBuild</code>.  Building the Blazor project in <code>Debug</code> mode does a one-off <code>tailwindcss</code> build, and <code>Release</code> mode results in a <code>cssnano</code>-minified build, thanks to their respective <code>build</code> and <code>publish</code> scripts found in <code>package.json</code>.</p>
<h3 id="install">The NpmInstallCheck Target</h3>
<p>The next (kinda optional) snippet actually runs in-between <code>AfterBuild</code> and <code>TailwindCSS</code> from above, doing a sanity check on <code>npm</code> stuff:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">tailwindcss.targets-p3</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Target</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NpmInstallCheck<span class="token punctuation">"</span></span> <span class="token attr-name">BeforeTargets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TailwindCSS<span class="token punctuation">"</span></span> <span class="token attr-name">Inputs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./package.json<span class="token punctuation">"</span></span> <span class="token attr-name">Outputs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./node_modules/.package-lock.json<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NpmInstallCheck Starting...<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm --version<span class="token punctuation">"</span></span> <span class="token attr-name">ContinueOnError</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">StandardOutputImportance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>low<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Output</span> <span class="token attr-name">TaskParameter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ExitCode<span class="token punctuation">"</span></span> <span class="token attr-name">PropertyName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Exec</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span> <span class="token attr-name">Condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>$(error)' != '0'<span class="token punctuation">"</span></span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>install node.js please ! https://nodejs.org/<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Exec</span> <span class="token attr-name">Command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>npm install<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NpmInstallCheck Finished !<span class="token punctuation">"</span></span> <span class="token attr-name">Importance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Target</span><span class="token punctuation">></span></span></pre>
</div></div>
<p>The <code>npm --version</code> command is there to verify Node.js/npm is installed: if it's not, the command will fail and you'll get a build error prompting to install node.js.  Otherwise <code>npm install</code> runs.  (When used without parameters <code>npm install</code> is akin to a <code>dotnet restore</code>, installing/updating dependencies listed in <code>package.json</code>, if needed.)</p>
<p>The <code>Inputs</code> &amp; <code>Outputs</code> are for MSBuild <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/how-to-build-incrementally?view=vs-2022" target="_blank">incremental build</a> magic, preventing this from running <strong>every. single. build.</strong>  If <code>Inputs</code> (<code>package.json</code>) is newer than <code>Outputs</code> (<code>.package-lock.json</code>), or <code>Outputs</code> doesn't yet exist, the Target is run, otherwise it will be skipped.</p>
<p>See <a href="https://stackoverflow.com/questions/35435041/run-npm-install-only-when-needed-and-or-partially?answertab=active#tab-top" target="_blank">here</a> for the StackOverflow-sauce, and <a href="https://github.com/McNerdius/TailBlazor/discussions/107" target="_blank">here</a> for some notes on the changes made to the StackOverflow version.</p>
<p>Assuming no errors, things will continue with the <code>TailwindCSS</code> target.</p>
<h3 id="optout">Opting out</h3>
<p>The top section just defines an MSBuild property we can use like so: <code>dotnet build -p:TailwindBuild=false</code> to let us opt out of running the Tailwind build.  Note its use in the next section.</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">tailwindcss.targets-p1</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TailwindBuild</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TailwindBuild</span><span class="token punctuation">></span></span></pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">></span></span></pre>
</div></div>
<hr />
<h2 id="cli">Using <code>dotnet watch</code> &amp; PowerShell</h2>
<p>A simple, sanity-checks-included PowerShell script:</p>
<div class="mc-code-block not-prose">
<div class="mc-code-filename">watch.ps1</div>
<div class="mc-code-lines">
<div class="mc-diff"></div> <pre class="mc-code">dotnet build <span class="token operator">-</span>p:TailwindBuild=false</pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token function">start</span> <span class="token string">"dotnet"</span> <span class="token operator">-</span>ArgumentList <span class="token string">"watch"</span> </pre>
<div class="mc-diff"></div> <pre class="mc-code"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token string">"./node_modules/.package-lock.json"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">sleep</span> <span class="token operator">-</span>ms 100 <span class="token punctuation">}</span> </pre>
<div class="mc-diff"></div> <pre class="mc-code">npm run watch</pre>
</div></div>
<p>Breaking it down:  I've found <code>dotnet watch</code> without a proper <code>dotnet build</code> beforehand can do strange things sometimes.  It's only once, so whatever.  Using <code>start</code> launches <code>dotnet watch</code> in its own process.  Unlike the first line in the script, this will include the <code>tailwind build</code> Target, possibly doing an <code>npm install</code> for the first time.  Only after <code>.package-lock.json</code> provides evidence of an <code>npm install</code> is it OK to kick off <code>tailwindcss</code> via <code>npm run watch</code>.  At this point, both .NET's Hot Reload and Tailwind's incremental build mode are watching for relevant changes.</p>
<hr />
<h2 id="vsc">Using VS Code</h2>
<p>See the <a href="https://github.com/McNerdius/TailBlazor-Templates/tree/main/Templates/SingleProject/TailBlazorWasm/.vscode" target="_blank">tailblazor-templates</a> repo to see launch tasks/configs for various project types.  It's a bit more robust than the <code>watch.ps1</code> script but pretty involved.  More to come on this.</p>
<hr />
<h2 id="vs">Using Visual Studio</h2>
<p>The best option i've found to integrate <code>tailwindcss --watch</code> with Visual Studio UI is to use the <a href="https://marketplace.visualstudio.com/items?itemName=MadsKristensen.NpmTaskRunner64" target="_blank">NPM Task Runner</a>, and bind the relevant <code>watch</code> script to &quot;Project Open&quot;. (Not &quot;After Build&quot;, see below.)</p>
<div class="info"><p>One-off <code>tailwindcss</code> builds are not ideal.  The long-running <code>tailwindcss --watch</code> is the only way to take advantage of Tailwind's super-fast incremental builds.</p>
</div>
<h3 id="vs-other">Other approaches</h3>
<ul>
<li><strong>Using a &quot;Post Build Event&quot; in Visual Studio's project properties.</strong></li>
</ul>
<p>This places an MSBuild Target in the <code>.csproj</code> - <code>&lt;Target Name=&quot;PostBuild&quot; AfterTargets=&quot;PostBuildEvent&quot;&gt;</code>. <strong>This is a no-go for long-running tasks:</strong> this and similar simple MSBuild Target based approaches do one of two things: terminate immediately or (more likely) hang the build.</p>
<ul>
<li><strong>More advanced uses of MSBuild Targets</strong></li>
</ul>
<p>One example is using <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-inline-tasks">Inline Tasks</a> - essentially embedding code within the <code>.csproj</code> (or more ideally, the <code>tailwindcss.targets</code> it points to) to kick off the npm task. It works but it's a bit ugly IMO. Visit <a href="/also">See Also</a> for a project using this approach.</p>
<ul>
<li><strong>Using Visual Studio Folders View's &quot;Configure Tasks&quot; / <code>tasks.vs.json</code></strong></li>
</ul>
<p>Visual Studio <a href="https://docs.microsoft.com/en-us/visualstudio/ide/customize-build-and-debug-tasks-in-visual-studio?view=vs-2022#define-tasks-with-tasksvsjson">supports tasks</a> much like VS Code which can be used to expose the needed scripts in a right-click menu in the Folder View. A few issues: You have to be in Folder View;  You still have to kick it off manually;  <strong>I couldn't get it to work.</strong>  Tried feeding it various combinations of working directories, no dice.</p>
<div class="info"><p>All in all, using the NPM Task Runner with Visual Studio takes little effort and Just Works, without injecting long-running tasks into the <code>.csproj</code>/<code>.targets</code> build files.</p>
</div>
<hr />
<div class="text-xl italic light text-right pr-6"><p><a href="/tidy_css">next: tidy css</a></p>
</div>
</div>
